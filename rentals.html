<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rental Transactions | Pastia's Party Rental</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="css/rentals.css">
  <link rel="stylesheet" href="css/return_modal.css">
  <link rel="stylesheet" href="css/calendar.css">
  <link rel="stylesheet" href="css/toast.css">
  <!-- FullCalendar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet">
  <!-- FullCalendar JS -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="js/toast.js"></script>
</head>

<body>
  <div class="app-shell">
    <aside class="sidebar">
      <div class="brand">
        <div class="brand-icon"><i data-lucide="party-popper"></i></div>
        <div>
          <p class="brand-name">Pastia's Party Rental</p>
          <p class="brand-subtitle">Management System</p>
        </div>
      </div>

      <nav class="nav">
        <a class="nav-item" href="dashboard.html"><i data-lucide="home"></i> Dashboard</a>
        <a class="nav-item" href="inventory.html"><i data-lucide="package"></i> Inventory</a>
        <a class="nav-item active" href="rentals.html"><i data-lucide="file-text"></i> Rental Transactions</a>
        <a class="nav-item" href="history.html"><i data-lucide="history"></i> Inventory History</a>
        <a class="nav-item" href="return_history.html"><i data-lucide="archive"></i> Return History</a>
        <a class="nav-item" href="reports.html"><i data-lucide="bar-chart-3"></i> Rental Reports</a>
        <a class="nav-item" href="users.html"><i data-lucide="users"></i> Users</a>
      </nav>
    </aside>

    <main class="content">
      <header class="page-header">
        <h1>Rental Transactions</h1>
        <div class="page-right">
          <span class="welcome-text"><span id="welcomeUser">Welcome, User</span></span>
          <button id="logoutButton" class="logout-btn">Logout</button>

          <script type="module">
            import { logoutUser } from "js/auth.js";
            document.getElementById("logoutButton").addEventListener("click", logoutUser);
          </script>
        </div>
      </header>

      <!-- View Tabs -->
      <div class="view-tabs">
        <button id="listViewTab" class="tab-btn active" data-view="list">
          <i data-lucide="list"></i> List View
        </button>
        <button id="calendarViewTab" class="tab-btn" data-view="calendar">
          <i data-lucide="calendar"></i> Calendar View
        </button>
      </div>

      <!-- List View Container (existing table) -->
      <div id="listView" class="view-container active">
        <div class="action-bar" style="display: flex; gap: 10px; align-items: center; margin-bottom: 20px;">
          <button id="addRentalBtn" class="primary-button">New Rental</button>
          <div style="display: flex; align-items: center; gap: 8px;">
            <label class="switch">
              <input type="checkbox" id="viewHistoryToggle">
              <span class="slider round"></span>
            </label>
            <span id="historyLabel">View Archived History</span>
          </div>
        </div>

        <section class="table-container">
          <table>
            <thead>
              <tr>
                <th>Item</th>
                <th>Client</th>
                <th>Quantity</th>
                <th>Rental Date</th>
                <th>Return Date</th>
                <th>Payment</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="rentalsTableBody"></tbody>
          </table>
          <p class="empty-hint" id="rentalsEmptyHint">No rental records yet.</p>
        </section>
      </div>
      <!-- End List View -->

      <!-- Calendar View Container -->
      <div id="calendarView" class="view-container hidden">
        <div class="calendar-controls">
          <!-- Item Availability Checker -->
          <div class="item-availability-selector" style="margin-bottom: 1rem;">
            <label for="calendarItemFilter" style="font-weight: 600; margin-right: 0.5rem;">Check Item
              Availability:</label>
            <select id="calendarItemFilter"
              style="padding: 8px 12px; border-radius: 6px; border: 1px solid #ccc; margin-right: 0.5rem;">
              <option value="">-- Show All Rentals --</option>
            </select>
            <button id="clearItemFilter" class="secondary-button" style="padding: 8px 16px;">Clear Filter</button>
          </div>

          <!-- Availability Legend (hidden by default, shown when item selected) -->
          <div id="availabilityLegend" class="hidden"
            style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 0.75rem; background: #f8f9fa; border-radius: 8px; align-items: center;">
            <span style="font-weight: 600; color: #666;">Legend:</span>
            <span class="legend-item" style="display: flex; align-items: center; gap: 0.5rem;">
              <span class="legend-color"
                style="width: 20px; height: 20px; border-radius: 4px; background: #4caf50;"></span>
              <span>Available</span>
            </span>
            <span class="legend-item" style="display: flex; align-items: center; gap: 0.5rem;">
              <span class="legend-color"
                style="width: 20px; height: 20px; border-radius: 4px; background: #ff9800;"></span>
              <span>Partially Booked</span>
            </span>
            <span class="legend-item" style="display: flex; align-items: center; gap: 0.5rem;">
              <span class="legend-color"
                style="width: 20px; height: 20px; border-radius: 4px; background: #f44336;"></span>
              <span>Fully Booked</span>
            </span>
          </div>

          <!-- Status Filters -->
          <div class="calendar-filters">
            <label>
              <input type="checkbox" id="filterActive" checked> Active
            </label>
            <label>
              <input type="checkbox" id="filterReserved" checked> Reserved
            </label>
            <label>
              <input type="checkbox" id="filterCancelled" checked> Cancelled
            </label>
          </div>
        </div>
        <div id="calendar"></div>
      </div>
      <!-- End Calendar View -->
    </main>

    <!-- Add Rental Modal -->
    <div id="addRentalModal" class="modal hidden" aria-hidden="true" role="dialog">
      <div id="addRentalOverlay" class="modal-overlay"></div>
      <div class="modal-card" style="max-width: 800px; width: 90%;">
        <div class="modal-header">
          <h2 id="modalTitle">New Rental</h2>
          <button id="cancelRentalBtn" class="close-modal-btn"
            style="background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
        </div>
        <div class="modal-body">
          <!-- Transaction Type Selector -->
          <div class="form-group"
            style="border: 2px solid var(--color-primary-200); border-radius: var(--radius-xl); padding: var(--space-4); background: var(--color-primary-50); margin-bottom: var(--space-5);">
            <label
              style="font-weight: 700; font-size: 15px; margin-bottom: var(--space-3); display: block; color: var(--color-primary-800);">Transaction
              Type *</label>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-3);">
              <button type="button" id="transactionTypeRental" class="transaction-type-btn active" data-type="rental"
                style="padding: var(--space-4); border: 2px solid var(--color-primary-500); border-radius: var(--radius-lg); background: linear-gradient(135deg, var(--color-primary-500) 0%, var(--color-primary-600) 100%); color: white; font-weight: 700; cursor: pointer; transition: all var(--transition-base);">
                <i data-lucide="calendar" style="width: 20px; height: 20px; margin-bottom: 4px;"></i>
                <div>Rental</div>
                <small style="font-size: 11px; opacity: 0.9;">Items to be returned</small>
              </button>
              <button type="button" id="transactionTypeSale" class="transaction-type-btn" data-type="sale"
                style="padding: var(--space-4); border: 2px solid var(--color-gray-300); border-radius: var(--radius-lg); background: white; color: var(--color-gray-700); font-weight: 700; cursor: pointer; transition: all var(--transition-base);">
                <i data-lucide="shopping-bag" style="width: 20px; height: 20px; margin-bottom: 4px;"></i>
                <div>Sale</div>
                <small style="font-size: 11px; opacity: 0.7;">One-time purchase</small>
              </button>
            </div>
          </div>

          <div class="form-group">
            <label for="rentalClientName">Client Name *</label>
            <input type="text" id="rentalClientName" placeholder="e.g. John Doe">
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="rentalClientPhone">Phone Number</label>
              <input type="tel" id="rentalClientPhone" placeholder="e.g. 0912-345-6789">
            </div>
            <div class="form-group">
              <label for="rentalClientAddress">Address</label>
              <input type="text" id="rentalClientAddress" placeholder="e.g. 123 Main St, City">
            </div>
          </div>

          <div class="form-row" style="grid-template-columns: 2fr 1fr;">
            <div class="form-group" style="position: relative;">
              <label for="rentalItemSearch">Item * <small style="color: #888; font-weight: normal;">(Type to search or
                  click to see all)</small></label>
              <div style="position: relative;">
                <input type="text" id="rentalItemSearch" placeholder="Search for items by name..." autocomplete="off"
                  style="width: 100%; padding-right: 40px;">
                <button type="button" id="showAllItemsBtn"
                  style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: #6b7280; padding: 4px 8px;"
                  title="Show all items">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"></polyline>
                  </svg>
                </button>
              </div>
              <div id="itemSearchResults" class="search-dropdown hidden">
                <!-- Dropdown with search results will appear here -->
              </div>
              <input type="hidden" id="rentalItem" value="">
            </div>
            <div class="form-group">
              <label for="rentalQty">Quantity *</label>
              <input type="number" id="rentalQty" value="1" min="1">
            </div>
          </div>

          <!-- Add to Cart Button (only visible for new rentals) -->
          <div id="addToCartSection" style="margin-bottom: 1rem;">
            <button type="button" id="addToCartBtn" class="secondary-button"
              style="width:100%; background: #2196F3; color: white; border: none; border-radius: 8px; padding: 10px; cursor: pointer; font-weight: 600;">
              ‚ûï Add Item to Cart
            </button>
          </div>

          <!-- Cart Items Display -->
          <div id="cartSection"
            style="display: none; margin-bottom: 1rem; border: 2px solid #2196F3; border-radius: 8px; padding: 1rem; background: #f8f9fa;">
            <h4 style="margin-top: 0; color: #2196F3;">üõí Cart Items</h4>
            <div style="overflow-x: auto;">
              <table id="cartItemsTable"
                style="width: 100%; border-collapse: collapse; font-size: 0.85rem; table-layout: fixed;">
                <colgroup>
                  <col style="width: 22%;">
                  <col style="width: 8%;">
                  <col style="width: 45%;">
                  <col style="width: 13%;">
                  <col style="width: 12%;">
                </colgroup>
                <thead>
                  <tr style="background: #e3f2fd;">
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid #2196F3; white-space: nowrap;">
                      ITEM</th>
                    <th
                      style="padding: 8px; text-align: center; border-bottom: 2px solid #2196F3; white-space: nowrap;">
                      QTY</th>
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid #2196F3; white-space: nowrap;">
                      PRICE</th>
                    <th style="padding: 8px; text-align: right; border-bottom: 2px solid #2196F3; white-space: nowrap;">
                      SUBTOTAL</th>
                    <th
                      style="padding: 8px; text-align: center; border-bottom: 2px solid #2196F3; white-space: nowrap;">
                      ACTION</th>
                  </tr>
                </thead>
                <tbody id="cartItemsBody">
                  <!-- Cart items will be inserted here -->
                </tbody>
                <tfoot>
                  <tr style="font-weight: bold; background: #e3f2fd;">
                    <td colspan="3" style="padding: 8px; text-align: right; border-top: 2px solid #2196F3;">Total:</td>
                    <td id="cartTotal"
                      style="padding: 8px; text-align: right; border-top: 2px solid #2196F3; color: #4caf50;">‚Ç±0.00</td>
                    <td style="border-top: 2px solid #2196F3;"></td>
                  </tr>
                </tfoot>
              </table>
            </div>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.85rem; color: #666;">
              <em>Tip: Add all items you want to rent, then fill in dates and payment details below.</em>
            </p>
          </div>

          <!-- Original Dates Section (shown when editing/rescheduling) -->
          <div id="originalDatesSection"
            style="display: none; margin-bottom: 1rem; padding: 1rem; background: #f9fafb; border-radius: 8px; border-left: 4px solid #9ca3af;">
            <h4 style="margin: 0 0 0.75rem; color: #6b7280; font-size: 0.9rem; font-weight: 600;">üìÖ Original Scheduled
              Dates</h4>
            <div class="form-row">
              <div class="form-group">
                <label for="originalRentalDate" style="color: #6b7280;">Original Rental Date</label>
                <input type="date" id="originalRentalDate" readonly style="background: #e5e7eb; cursor: not-allowed;">
              </div>
              <div class="form-group">
                <label for="originalReturnDate" style="color: #6b7280;">Original Return Date</label>
                <input type="date" id="originalReturnDate" readonly style="background: #e5e7eb; cursor: not-allowed;">
              </div>
            </div>
            <p style="margin: 0.5rem 0 0; font-size: 0.85rem; color: #6b7280;">‚ÑπÔ∏è These are the originally scheduled
              dates for reference.</p>
          </div>

          <!-- Reschedule To Section Header (shown when editing) -->
          <h4 id="rescheduleSectionHeader"
            style="display: none; margin: 0 0 0.5rem; color: #2563eb; font-size: 0.95rem; font-weight: 600;">üîÑ
            Reschedule To (New Dates)</h4>

          <div class="form-row">
            <div class="form-group">
              <label for="rentalDate">Rental Date *</label>
              <input type="date" id="rentalDate">
            </div>
            <div class="form-group">
              <label for="returnDate">Return Date *</label>
              <input type="date" id="returnDate">
            </div>
          </div>

          <!-- Time fields for hour-based rentals -->
          <div class="form-row">
            <div class="form-group">
              <label for="rentalTime">
                Start Time <small style="color: #888; font-weight: normal;">(Optional - leave blank for all-day)</small>
              </label>
              <input type="time" id="rentalTime" placeholder="e.g. 09:00">
            </div>
            <div class="form-group">
              <label for="returnTime">
                End Time <small style="color: #888; font-weight: normal;">(Optional)</small>
              </label>
              <input type="time" id="returnTime" placeholder="e.g. 16:00">
            </div>
          </div>

          <p class="info-text" style="font-size: 0.85rem; color: #666; margin-top: -0.5rem;">
            üí° Tip: Leave times blank for all-day rentals. Specify times for hour-based bookings (e.g., 9am - 4pm).
          </p>

          <p id="availabilityInfo" class="info-text" style="margin-bottom: 1rem; font-size: 0.9rem;">Select item and
            dates to check availability</p>

          <hr style="margin: 1rem 0; border: 0; border-top: 1px solid #eee;">
          <h3>Payment Details</h3>

          <div class="form-row">
            <div class="form-group">
              <label for="paymentAmount">Total Amount (Auto-calculated)</label>
              <input type="number" id="paymentAmount" value="0" min="0" readonly>
              <small id="priceCalculation"
                style="color: #666; font-size: 0.85rem; display: block; margin-top: 4px;">Select item and
                quantity</small>
            </div>
            <div class="form-group">
              <label for="paymentMethod">Method</label>
              <select id="paymentMethod">
                <option value="Cash">Cash</option>
                <option value="GCash">GCash</option>
              </select>
            </div>
          </div>

          <!-- Advance Payment Section -->
          <div class="form-row">
            <div class="form-group">
              <label for="advancePayment">Advance Payment (Optional)</label>
              <input type="number" id="advancePayment" value="0" min="0" step="0.01" placeholder="Enter advance amount">
              <small style="color: #666; font-size: 0.85rem; display: block; margin-top: 4px;">Amount paid
                upfront</small>
            </div>
            <div class="form-group">
              <label>Balance Due</label>
              <div id="balanceDue" style="
                padding: 10px 12px;
                background: #f8f9fa;
                border: 2px solid #dee2e6;
                border-radius: 8px;
                font-size: 1.1rem;
                font-weight: 700;
                color: #495057;
                text-align: center;
              ">‚Ç±0.00</div>
              <small style="color: #666; font-size: 0.85rem; display: block; margin-top: 4px;">Remaining balance</small>
            </div>
          </div>

          <div class="form-group">
            <label>
              <input type="checkbox" id="customPriceCheckbox" style="width: auto; margin-right: 8px;">
              Custom Price
            </label>
          </div>

          <div class="form-group">
            <label for="paymentStatus">Payment Status</label>
            <select id="paymentStatus">
              <option value="Pending">Pending</option>
              <option value="Paid">Paid</option>
              <option value="Partial">Partial</option>
              <option value="Cancelled">Cancelled</option>
            </select>
          </div>

          <div class="form-group">
            <label for="rentalStatus">Rental Status</label>
            <select id="rentalStatus">
              <option value="active">Open</option>
              <option value="reserved">Reserved (Future)</option>
              <option value="returned">Closed</option>
              <option value="cancelled">Cancelled</option>
            </select>
          </div>

        </div>
        <div class="modal-footer" style="margin-top: 20px;">
          <button id="saveRentalBtn" class="primary-button" style="width:100%">Save Rental</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Missing Items Confirmation Modal -->
  <div id="missingItemsModal" class="modal hidden" aria-hidden="true" role="dialog">
    <div id="missingItemsOverlay" class="modal-overlay"></div>
    <div class="modal-card" style="max-width: 600px;">
      <div class="modal-header">
        <h2>Return Confirmation</h2>
        <button id="cancelMissingItemsBtn" class="close-modal-btn"
          style="background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Initial condition choice -->
        <div id="returnChoiceSection">
          <p style="font-size: 1.1rem; margin-bottom: 2rem; color: #555; text-align: center; line-height: 1.6;">
            What is the condition of the returned items?
          </p>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
            <!-- All Good Button -->
            <button id="allGoodBtn" class="return-choice-btn return-success">
              <div class="return-icon">‚úì</div>
              <div class="return-label">All Good</div>
              <div class="return-sublabel">Perfect condition</div>
            </button>

            <!-- Some Damaged Button -->
            <button id="someDamagedBtn" class="return-choice-btn return-damaged">
              <div class="return-icon">‚ö†</div>
              <div class="return-label">Some Damaged</div>
              <div class="return-sublabel">Needs repair</div>
            </button>

            <!-- Some Missing Button -->
            <button id="someMissingBtn" class="return-choice-btn return-warning">
              <div class="return-icon">‚úó</div>
              <div class="return-label">Some Missing</div>
              <div class="return-sublabel">Not returned</div>
            </button>
          </div>
        </div>

        <!-- Damage Details Form (hidden initially) -->
        <div id="damageDetailsForm" style="display: none;">
          <h3 style="color: #FF9800; margin-top: 0;">‚ö†Ô∏è Damage Details</h3>
          <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">
            For each item below, specify the condition and damage severity.
          </p>
          <div id="damageItemsList" style="max-height: 400px; overflow-y: auto;">
            <!-- Damage items inputs will be generated here -->
          </div>

          <!-- Penalty Section -->
          <div
            style="margin-top: 1.5rem; padding: 1rem; background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px;">
            <h4 style="margin: 0 0 1rem 0; color: #856404; font-size: 0.95rem;">üí∞ Penalty/Damage Charges</h4>
            <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px;">
              <div>
                <label for="penaltyAmount" style="display: block; margin-bottom: 4px; font-weight: 600;">Penalty
                  Amount</label>
                <input type="number" id="penaltyAmount" min="0" step="0.01" value="0" placeholder="0.00"
                  style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 6px;">
              </div>
              <div>
                <label for="penaltyReason" style="display: block; margin-bottom: 4px; font-weight: 600;">Penalty
                  Reason</label>
                <input type="text" id="penaltyReason" placeholder="e.g., Broken chair leg, stained tablecloth"
                  style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 6px;">
              </div>
            </div>
            <p style="margin: 0.5rem 0 0; font-size: 0.85rem; color: #856404;">
              ‚ÑπÔ∏è Add charges for damaged items. This will be saved with the rental record.
            </p>
          </div>

          <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 2px solid #eee;">
            <label for="damageNotes" style="display: block; margin-bottom: 8px; font-weight: 600;">Damage Description
              *</label>
            <textarea id="damageNotes" rows="4"
              placeholder="Describe the damage (e.g., scratched surface, broken leg, stained fabric)..."
              style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; font-family: inherit;"
              required></textarea>
          </div>
          <div style="display: flex; gap: 12px; margin-top: 1rem;">
            <button id="confirmDamageBtn" class="primary-button"
              style="flex: 1; padding: 12px 24px; background: #FF9800;">
              Confirm Damage
            </button>
            <button id="cancelDamageFormBtn" class="secondary-button"
              style="flex: 1; padding: 12px 24px; background: #6c757d;">
              Go Back
            </button>
          </div>
        </div>

        <!-- Missing items form (hidden initially) -->
        <div id="missingItemsForm" style="display: none;">
          <h3 style="color: #FF9800; margin-top: 0;">Specify Missing Items</h3>
          <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">
            For each item below, enter the quantity that is missing. Items with 0 missing will be marked as returned.
          </p>
          <div id="missingItemsList" style="max-height: 400px; overflow-y: auto;">
            <!-- Missing items inputs will be generated here -->
          </div>
          <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 2px solid #eee;">
            <label for="missingNotes" style="display: block; margin-bottom: 8px; font-weight: 600;">Additional Notes
              (Optional)</label>
            <textarea id="missingNotes" rows="3"
              placeholder="Any additional comments about the return or missing items..."
              style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; font-family: inherit;"></textarea>
          </div>
          <div style="display: flex; gap: 12px; margin-top: 1rem;">
            <button id="confirmMissingBtn" class="primary-button" style="flex: 1; padding: 12px 24px;">
              Confirm Return
            </button>
            <button id="cancelMissingFormBtn" class="secondary-button"
              style="flex: 1; padding: 12px 24px; background: #6c757d;">
              Go Back
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Cancel/Reschedule Modal -->
  <div id="cancelRescheduleModal" class="modal hidden" aria-hidden="true" role="dialog">
    <div class="modal-overlay" id="cancelRescheduleOverlay"></div>
    <div class="modal-card" style="max-width: 500px;">
      <div class="modal-header">
        <h2>Cancel Reservation?</h2>
        <button id="closeCancelRescheduleBtn" class="close-modal-btn"
          style="background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
      </div>
      <div class="modal-body">
        <p style="margin-bottom: 1.5rem; color: #6b7280; text-align: center;">
          Would you like to cancel this reservation or reschedule it to another date?
        </p>
        <div style="display: grid; gap: 12px;">
          <button id="rescheduleBtn" class="reschedule-choice-btn">
            <div style="display: flex; align-items: center; gap: 12px;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
              <div style="text-align: left;">
                <div style="font-weight: 700;">Reschedule to Another Date</div>
                <small style="opacity: 0.8; font-size: 0.85rem;">Keep the reservation and change the dates</small>
              </div>
            </div>
          </button>
          <button id="cancelCompletelyBtn" class="cancel-choice-btn">
            <div style="display: flex; align-items: center; gap: 12px;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="15" y1="9" x2="9" y2="15"></line>
                <line x1="9" y1="9" x2="15" y2="15"></line>
              </svg>
              <div style="text-align: left;">
                <div style="font-weight: 700;">Cancel Reservation</div>
                <small style="opacity: 0.8; font-size: 0.85rem;">Permanently remove this reservation</small>
              </div>
            </div>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- View Transaction Modal (Read-Only) -->
  <div id="viewRentalModal" class="modal hidden" aria-hidden="true" role="dialog">
    <div id="viewRental Overlay" class="modal-overlay"></div>
    <div class="modal-card" style="max-width: 900px; width: 90%;">
      <div class="modal-header">
        <h2>üìã Transaction Details</h2>
        <button id="closeViewRentalBtn" class="close-modal-btn"
          style="background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
      </div>
      <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">

        <!-- Customer Information -->
        <div style="margin-bottom: 1.5rem; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
          <h3 style="margin: 0 0 0.75rem 0; color: #2196F3; font-size: 1rem;">üë§ Customer Information</h3>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
            <div>
              <strong style="font-size: 0.85rem; color: #666;">Name:</strong>
              <p id="viewClientName" style="margin: 4px 0 0; font-size: 0.95rem;">-</p>
            </div>
            <div>
              <strong style="font-size: 0.85rem; color: #666;">Phone:</strong>
              <p id="viewClientPhone" style="margin: 4px 0 0; font-size: 0.95rem;">-</p>
            </div>
            <div>
              <strong style="font-size: 0.85rem; color: #666;">Address:</strong>
              <p id="viewClientAddress" style="margin: 4px 0 0; font-size: 0.95rem;">-</p>
            </div>
          </div>
        </div>

        <!-- Rental Details -->
        <div style="margin-bottom: 1.5rem; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
          <h3 style="margin: 0 0 0.75rem 0; color: #2196F3; font-size: 1rem;">üìÖ Rental Schedule</h3>
          <div id="viewScheduleGrid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
            <div>
              <strong style="font-size: 0.85rem; color: #666;">Rental Date:</strong>
              <p id="viewRentalDate" style="margin: 4px 0 0; font-size: 0.95rem;">-</p>
            </div>
            <div>
              <strong style="font-size: 0.85rem; color: #666;">Return Date:</strong>
              <p id="viewReturnDate" style="margin: 4px 0 0; font-size: 0.95rem;">-</p>
            </div>
            <div id="viewTimeSection" style="display: none;">
              <strong style="font-size: 0.85rem; color: #666;">Start Time:</strong>
              <p id="viewRentalTime" style="margin: 4px 0 0; font-size: 0.95rem;">-</p>
            </div>
            <div id="viewEndTimeSection" style="display: none;">
              <strong style="font-size: 0.85rem; color: #666;">End Time:</strong>
              <p id="viewReturnTime" style="margin: 4px 0 0; font-size: 0.95rem;">-</p>
            </div>
          </div>
        </div>

        <!-- Items List -->
        <div
          style="margin-bottom: 1.5rem; padding: 1rem; background: #fff; border: 2px solid #2196F3; border-radius: 8px;">
          <h3 style="margin: 0 0 0.75rem 0; color: #2196F3; font-size: 1rem;">üõí Rented Items</h3>
          <div id="viewItemsList" style="overflow-x: auto;">
            <!-- Items will be populated here -->
          </div>
        </div>

        <!-- Payment Information -->
        <div style="margin-bottom: 1.5rem; padding: 1rem; background: #e8f5e9; border-radius: 8px;">
          <h3 style="margin: 0 0 0.75rem 0; color: #4caf50; font-size: 1rem;">üí∞ Payment Information</h3>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
            <div>
              <strong style="font-size: 0.85rem; color: #666;">Total Amount:</strong>
              <p id="viewPaymentAmount" style="margin: 4px 0 0; font-size: 1.1rem; font-weight: 700; color: #4caf50;">-
              </p>
            </div>
            <div>
              <strong style="font-size: 0.85rem; color: #666;">Advance Payment:</strong>
              <p id="viewAdvancePayment" style="margin: 4px 0 0; font-size: 0.95rem;">‚Ç±0.00</p>
            </div>
            <div>
              <strong style="font-size: 0.85rem; color: #666;">Balance Due:</strong>
              <p id="viewBalanceDue" style="margin: 4px 0 0; font-size: 0.95rem;">‚Ç±0.00</p>
            </div>
            <div>
              <strong style="font-size: 0.85rem; color: #666;">Payment Method:</strong>
              <p id="viewPaymentMethod" style="margin: 4px 0 0; font-size: 0.95rem;">-</p>
            </div>
            <div>
              <strong style="font-size: 0.85rem; color: #666;">Payment Status:</strong>
              <p id="viewPaymentStatus" style="margin: 4px 0 0; font-size: 0.95rem;">-</p>
            </div>
            <div>
              <strong style="font-size: 0.85rem; color: #666;">Rental Status:</strong>
              <p id="viewRentalStatus" style="margin: 4px 0 0; font-size: 0.95rem;">-</p>
            </div>
          </div>
        </div>

        <!-- Penalty Information (if applicable) -->
        <div id="viewPenaltySection"
          style="display: none; margin-bottom: 1.5rem; padding: 1rem; background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px;">
          <h3 style="margin: 0 0 0.75rem 0; color: #856404; font-size: 1rem;">‚ö†Ô∏è Penalty/Damage Charges</h3>
          <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px;">
            <div>
              <strong style="font-size: 0.85rem; color: #666;">Penalty Amount:</strong>
              <p id="viewPenaltyAmount" style="margin: 4px 0 0; font-size: 1.1rem; font-weight: 700; color: #d32f2f;">
                ‚Ç±0.00</p>
            </div>
            <div>
              <strong style="font-size: 0.85rem; color: #666;">Reason:</strong>
              <p id="viewPenaltyReason" style="margin: 4px 0 0; font-size: 0.95rem;">-</p>
            </div>
          </div>
        </div>

        <!-- Transaction ID -->
        <div style="margin-top: 1rem; padding: 0.75rem; background: #f8f9fa; border-radius: 6px; text-align: center;">
          <small style="color: #666; font-size: 0.8rem;">Transaction ID: <span id="viewTransactionId"
              style="font-family: monospace; font-weight: 600;">-</span></small>
        </div>

      </div>
      <div class="modal-footer" style="margin-top: 20px;">
        <button id="closeViewRentalBtn2" class="secondary-button" style="width:100%">Close</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { isLoggedIn } from "./js/auth.js";

    const logged = await isLoggedIn();
    if (!logged) {
      window.location.href = "index.html";
    }
  </script>

  <!-- Supabase + Auth + Navigation (common for all pages) -->
  <script type="module" src="js/supabase.js"></script>
  <script type="module" src="js/auth.js"></script>
  <script type="module" src="js/navigation.js"></script>
  <script type="module" src="js/rentals.js"></script>
  <script type="module" src="js/calendar_functions.js"></script>

  <script>
    // Initialize Lucide icons
    lucide.createIcons();
  </script>

</body>

</html>